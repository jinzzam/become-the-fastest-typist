<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/typing-style.css') }}">
    <script src="{{ url_for('static', filename='js/typing.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.js') }}"></script>
    <script>

        function showMessageBox(message) {
            document.getElementById('messageContent').innerText = message;
            document.getElementById('messageBox').style.display = 'block';
        }

        $(document).ready(function () {
            // 언어 선택 드롭다운 메뉴의 값이 변경될 때마다 실행
            $("#language").on("change", function () {
                var selectedLanguage = $(this).val(); // 선택된 언어 값 가져오기 
                console.log("선택된 언어: " + selectedLanguage);

                $("#language").val(selectedLanguage).prop("selected", true);
                //  $("#mySelect").val("1").prop("selected", true);

                // 서버로 보낼 데이터 준비 "code-java", "code-python"
                var dataToSend = "code-" + selectedLanguage.toLowerCase();
                console.log("서버로 보낼 데이터: " + dataToSend);

                // AJAX 요청 시작
                $.ajax({
                    method: "POST", // POST 방식으로 요청
                    url: "/process-data", // Flask 서버의 새로 정의된 POST 라우트와 일치하도록 수정
                    data: { myData: dataToSend }, // 'myData'라는 이름으로 데이터 전송
                    success: function (response) {
                        // 요청이 성공했을 때 실행될 콜백 함수
                        // Flask 서버에서 반환한 JSON 응답을 받습니다.
                        console.log("서버 응답:", response);
                        if (response && response.message) {
                            showMessageBox("서버 응답: " + response.message + " (받은 데이터: " + selectedLanguage + ")");
                            characters = response.content;
                            for(const char of characters){
                                const newSpan = document.createElement("span");
                                newSpan.textContent = char;
                                const parentDiv = document.querySelector("#text-display");
                                parentDiv.appendChild(newSpan);
                            }
                            // $("#original-text").html(characters);
                            // $("#original-text").eq(0).addClass('cursor');

                            // 텍스트를 html로 그대로 넣기
                            // $("pre").html(characters);
                            // 맨 첫번째 요소에 커서 효과
                            // $("pre span").eq(0).addClass('cursor');
                        } else {
                            showMessageBox("알 수 없는 서버 응답 형식.");
                        }
                    },
                    error: function (xhr, status, error) {
                        // 요청이 실패했을 때 실행될 콜백 함수
                        console.error("AJAX Error:", status, error, xhr.responseText);
                        showMessageBox("에러 발생: " + (xhr.responseText || error));
                    }

                });
            });
        });
    </script>
    <title>타자 연습 프로그램</title>
</head>

<body>

    <div class="container">
        <div class="typing-area">
            <div id="parent-text-display" style="overflow-x: hidden; overflow-y: scroll; height: 260px;" readonly>
                <!-- 텍스트가 표시될 공간 -->
                <pre id="text-display"></pre>
            </div>
        </div>
        <!-- Python에서 전달받은 원본 텍스트를 숨겨서 저장 -->
        <div id="original-text" style="display: none;">{{ practice_content }}</div>

        <!-- 커스텀 메시지 박스 -->
        <div id="messageBox" class="message-box">
            <p id="messageContent" class="text-gray-800 text-lg mb-4"></p>
            <button onclick="document.getElementById('messageBox').style.display='none'">확인</button>
        </div>

        <div class="wrap_dropdown">
            <p>프로그래밍 언어</p>
            <select name="language" id="language">
                <option value="HTML" id="option1">HTML</option>
                <option value="CSS" id="option2">CSS</option>
                <option value="Javascript" id="option3">Javascript</option>
                <option value="Jquery" id="option4">Jquery</option>
                <option value="Python" id="option5">Python</option>
                <option value="Java" id="option6" selected>Java</option>
            </select>
        </div>



        <div class="keyboard">
            <div class="keyboard-row">
                <div class="key" id="key-Backquote" data-special-symbol="~" data-original="`">`</div>
                <div class="key" id="key-Digit1" data-special-symbol="!" data-original="1">1</div>
                <div class="key" id="key-Digit2" data-special-symbol="@" data-original="2">2</div>
                <div class="key" id="key-Digit3" data-special-symbol="#" data-original="3">3</div>
                <div class="key" id="key-Digit4" data-special-symbol="$" data-original="4">4</div>
                <div class="key" id="key-Digit5" data-special-symbol="%" data-original="5">5</div>
                <div class="key" id="key-Digit6" data-special-symbol="^" data-original="6">6</div>
                <div class="key" id="key-Digit7" data-special-symbol="&" data-original="7">7</div>
                <div class="key" id="key-Digit8" data-special-symbol="*" data-original="8">8</div>
                <div class="key" id="key-Digit9" data-special-symbol="(" data-original="9">9</div>
                <div class="key" id="key-Digit0" data-special-symbol=")" data-original="0">0</div>
                <div class="key" id="key-Minus" data-special-symbol="_" data-original="-">-</div>
                <div class="key" id="key-Equal" data-special-symbol="+" data-original="=">=</div>
                <div class="key backspace" id="key-Backspace">←</div>
            </div>

            <div class="keyboard-row">
                <div class="key tab" id="key-Tab">Tab</div>
                <div class="key kor" id="key-KeyQ" data-shift="Q" data-original="q" data-kor="ㅂ" data-kor-hard="ㅃ">q
                </div>
                <div class="key kor" id="key-KeyW" data-shift="W" data-original="w" data-kor="ㅈ" data-kor-hard="ㅉ">w
                </div>
                <div class="key kor" id="key-KeyE" data-shift="E" data-original="e" data-kor="ㄷ" data-kor-hard="ㄸ">e
                </div>
                <div class="key kor" id="key-KeyR" data-shift="R" data-original="r" data-kor="ㄱ" data-kor-hard="ㄲ">r
                </div>
                <div class="key kor" id="key-KeyT" data-shift="T" data-original="t" data-kor="ㅅ" data-kor-hard="ㅆ">t
                </div>
                <div class="key kor" id="key-KeyY" data-shift="Y" data-original="y" data-kor="ㅛ">y</div>
                <div class="key kor" id="key-KeyU" data-shift="U" data-original="u" data-kor="ㅕ">u</div>
                <div class="key kor" id="key-KeyI" data-shift="I" data-original="i" data-kor="ㅑ">i</div>
                <div class="key kor" id="key-KeyO" data-shift="O" data-original="o" data-kor="ㅐ" data-kor-hard="ㅒ">o
                </div>
                <div class="key kor" id="key-KeyP" data-shift="P" data-original="p" data-kor="ㅔ" data-kor-hard="ㅖ">p
                </div>
                <div class="key" id="key-BracketLeft" data-special-symbol="{" data-original="[">[</div>
                <div class="key" id="key-BracketRight" data-special-symbol="}" data-original="]">]</div>
                <div class="key backslash" id="key-Backslash" data-special-symbol="|" data-original="\">\</div>
            </div>

            <div class="keyboard-row">
                <div class="key caps" id="key-CapsLock">Caps Lock</div>
                <div class="key kor" id="key-KeyA" data-shift="A" data-original="a" data-kor="ㅁ">a</div>
                <div class="key kor" id="key-KeyS" data-shift="S" data-original="s" data-kor="ㄴ">s</div>
                <div class="key kor" id="key-KeyD" data-shift="D" data-original="d" data-kor="ㅇ">d</div>
                <div class="key kor" id="key-KeyF" data-shift="F" data-original="f" data-kor="ㄹ">f</div>
                <div class="key kor" id="key-KeyG" data-shift="G" data-original="g" data-kor="ㅎ">g</div>
                <div class="key kor" id="key-KeyH" data-shift="H" data-original="h" data-kor="ㅗ">h</div>
                <div class="key kor" id="key-KeyJ" data-shift="J" data-original="j" data-kor="ㅓ">j</div>
                <div class="key kor" id="key-KeyK" data-shift="K" data-original="k" data-kor="ㅏ">k</div>
                <div class="key kor" id="key-KeyL" data-shift="L" data-original="l" data-kor="ㅣ">l</div>
                <div class="key" id="key-Semicolon" data-special-symbol=":" data-original=";">;</div>
                <div class="key" id="key-Quote" data-special-symbol='"' data-original="'">'</div>
                <div class="key enter" id="key-Enter">Enter</div>
            </div>

            <div class="keyboard-row">
                <div class="key shift" id="key-ShiftLeft">Shift</div>
                <div class="key kor" id="key-KeyZ" data-shift="Z" data-original="z" data-kor="ㅋ">z</div>
                <div class="key kor" id="key-KeyX" data-shift="X" data-original="x" data-kor="ㅌ">x</div>
                <div class="key kor" id="key-KeyC" data-shift="C" data-original="c" data-kor="ㅊ">c</div>
                <div class="key kor" id="key-KeyV" data-shift="V" data-original="v" data-kor="ㅍ">v</div>
                <div class="key kor" id="key-KeyB" data-shift="B" data-original="b" data-kor="ㅠ">b</div>
                <div class="key kor" id="key-KeyN" data-shift="N" data-original="n" data-kor="ㅜ">n</div>
                <div class="key kor" id="key-KeyM" data-shift="M" data-original="m" data-kor="ㅡ">m</div>
                <div class="key" id="key-Comma" data-special-symbol="&lt;" data-original=",">,</div>
                <div class="key" id="key-Period" data-special-symbol=">" data-original=".">.</div>
                <div class="key" id="key-Slash" data-special-symbol="?" data-original="/">/</div>
                <div class="key shift" id="key-ShiftRight">Shift</div>
            </div>

            <div class="keyboard-row">
                <div class="key ctrl" id="key-ControlLeft">Ctrl</div>
                <div class="key win" id="key-MetaLeft">Win</div>
                <div class="key alt" id="key-AltLeft">Alt</div>
                <div class="key space" id="key-Space"> </div>
                <div class="key hangul-eng" id="key-HangulMode" data-original="한/영">한/영</div>
                <!-- Changed ID to match event.key 'HangulMode' directly -->

                <!-- <div class="key alt" id="key-AltRight">Alt</div>
                    <div class="key win" id="key-MetaRight">Win</div>
                    <div class="key menu" id="key-ContextMenu">Menu</div>
                    <div class="key ctrl" id="key-ControlRight">Ctrl</div> -->
            </div>
        </div>
    </div>
</body>

</html>